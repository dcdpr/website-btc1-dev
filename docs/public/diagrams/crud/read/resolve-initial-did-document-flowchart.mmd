---
title: 5.2.1 Resolve Initial DID Document
---

flowchart TD

    Start@{ shape: circle, label: "Resolve Initial<br>DID Document" } --> CheckIdType{ idType }

    %% Deterministic Path
    CheckIdType -->|KEY| Deterministic@{ shape: subproc, label: "Deterministically<br/>Generate Initial DID<br/>Document" }
    Deterministic --> GenerateBeacon@{ shape: subproc, label: "Generate<br/>Beacon<br/>Services" }
    GenerateBeacon --> EstablishSingleton@{ shape: subproc, label: "Establish<br/>Singleton<br/>Beacon" }

    %% External Path
    CheckIdType -->|EXTERNAL| External@{ shape: subproc, label: "External Resolution" }
    External -->CheckSidecarData{resolutionOptions.<br>sidecarData.<br>initialDocument}
    CheckSidecarData-->|NOT NULL| SidecarValidate@{ shape: subproc, label: "Sidecar Initial<br/>DID Document<br/>Validation" }
    CheckSidecarData-->|NULL| CasRetrieval@{ shape: subproc, label: "CAS Retrieval" }
    CasRetrieval-->CheckInitialDocument{ initialDocument }
    SidecarValidate-->CheckInitialDocument
    CheckInitialDocument-->|VALID| ReturnInitialDocument@{ shape: lean-l, label: "Return initialDocument" }

    %% Error
    CheckIdType -->|ERROR| InvalidHRPValue@{ shape: stadium, label: "InvalidHRPValue" }
    CheckInitialDocument-->|INVALID| InvalidDIDDocumentError@{ shape: stadium, label: "InvalidDIDDocumentError" }

    %% Return
    EstablishSingleton --> ReturnInitialDocument
