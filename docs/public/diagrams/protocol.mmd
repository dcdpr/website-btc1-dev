---
title: DID BTC1 Protocol Stack
---

graph TB
  %% ---------- Styles ----------
  classDef layer fill:#f7f7fb
  classDef comp fill:#ffffff,stroke:#c7cdd1,rx:6,ry:6,color:#202124

  %% ---------- Layers ----------
  subgraph L6[Application / Use Layer]
    direction TB
    Wallets[Identity Wallets]:::comp
    VCVerify[VC / Signature Verification]:::comp
  end

  subgraph L5[DID Resolution & API Layer]
    direction TB
    Resolver[BTC1 Resolver<br/>Traverse History<br>Apply patches<br>Update DID Document]:::comp
    JSONLD[JSON-LD<br/>Processing]:::comp
    DIDCore[DID Core<br/>Compliance]:::comp
    APIs[Resolver APIs]:::comp
  end

  subgraph L4[Data Integrity & Proof Layer]
    direction TB
    KeyMgr[Key<br/>Manager]:::comp
    BIP340Crypto[BIP340<br/>Cryptosuite]:::comp
    BIP340Multikey[BIP340<br/>Multikey]:::comp
    BIP340DIPCrypto[BIP340<br/>Proofs]:::comp
    MuSig[MuSig2<br/>Aggregation]:::comp
  end

  subgraph L3[DID Document State Layer]
    direction TB
    Patches[JSON Patch]:::comp
    Model[BTC1 DID Document]:::comp
    InterDoc[Intermediate<br/>DID documents]:::comp
    Rules[Resolution Rules<br/>& Versioning]:::comp
  end

  subgraph L2[Beacon Layer]
    direction TB
    Ops[BTC1 Update]:::comp
    Anchors[BTC1 Beacon Signals<br/>commitments to state/patches]:::comp
    Beacon[SingletonBeacon<br/>MapBeacon<br/>SMTBeacon]:::comp
    Linkage[Tx hash linkage & verification]:::comp
  end

  subgraph L1[Bitcoin Ledger Layer]
    direction TB
    BTC[Bitcoin tx on main/test/reg networks]:::comp
    OPRET[OP_RETURN CID Embedding]:::comp
    OPRET[SMT Proof Aggregation]:::comp
    PSBT["PSBT"]:::comp
    Finality[Consensus, confirmations, finality]:::comp
  end

  %% ---------- Layer connections ----------
  L6 --> L5 --> L4 --> L3 --> L2 --> L1

  %% Optional: show a typical data flow up & down (comment out if noisy)
  %% Resolver ==> uses proofs/state anchored on chain
  Resolver -.reads/applies.-> Patches
  Resolver -.reads.-> Anchors
  Anchors -.on-chain.-> BTC

  %% ---------- Apply layer framing ----------
  class L1,L2,L3,L4,L5,L6 layer
